local aa=require("basaltLoader") local ba=aa.load("VisualElement")local ca=require("utils").tHex;local da=setmetatable({},ba) da.__index=da;da:initialize("Slider") da:addProperty("knobSymbol","string"," ") da:addProperty("knobBackground","color",colors.black) da:addProperty("knobForeground","color",colors.black)da:addProperty("bgSymbol","string","\140") da:addProperty("value","number",0)da:addProperty("minValue","number",0) da:addProperty("maxValue","number",100)da:addProperty("step","number",1) da:combineProperty("knob","knobSymbol","knobBackground","knobForeground")da:addListener("change","value_change") function da:new(ab,bb,cb) local db=ba:new(ab,bb,cb)setmetatable(db,self)self.__index=self db:setType("Slider")db:create("Slider")db:setSize(20,1)return db end da:extend("Load",function(ab)ab:listenEvent("mouse_click") ab:listenEvent("mouse_drag")ab:listenEvent("mouse_up") ab:listenEvent("mouse_scroll")end) local function _b(ab,bb,cb)local db,_c=ab:getPosition()local ac,bc=ab:getSize() local cc=ab:getValue()local dc=ab:getMaxValue()local _d=ab:getMinValue() local ad=ab:getStep()local bd=bb-db;cc=bd/ (ac-1)* (dc-_d)+_d;cc=math.floor( (cc+ad/2)/ad)*ad cc=math.max(_d,math.min(dc,cc))ab:setValue(cc)ab:fireEvent("change",cc) ab:updateRender()end function da:mouse_click(ab,bb,cb)if(ba.mouse_click(self,ab,bb,cb))then if(ab==1)then _b(self,bb,cb)end;return true end end function da:mouse_drag(ab,bb,cb)if(ba.mouse_drag(self,ab,bb,cb))then if(ab==1)then _b(self,bb,cb)end;return true end end function da:mouse_scroll(ab,bb,cb) if ba.mouse_scroll(self,ab,bb,cb)then local db=self:getValue() local _c=self:getMinValue()local ac=self:getMaxValue()local bc=self:getWidth() local cc=(ac-_c)/ (bc-1)if ab==1 then db=db+cc else db=db-cc end db=math.max(_c,math.min(db,ac))self:setValue(db)self:fireEvent("change",db) self:updateRender()return true end end function da:render()ba.render(self) local ab=(self.bgSymbol):rep(self.width) local bb=math.floor( (self.value-self.minValue)/ (self.maxValue-self.minValue)* (self.width-1)+0.5) ab=ab:sub(1,bb)..self.knobSymbol..ab:sub(bb+2,-1)self:addText(1,1,ab) self:addBg(bb+1,1,ca[self:getKnobBackground()]) self:addFg(bb+1,1,ca[self:getKnobForeground()])end;return da